<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>结果 - {{ filename }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='app.css', v=static_v) }}" />
  </head>
  <body>
    <div class="topbar">
      <div class="brand">
        <div class="logo">
           <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </div>
        <div class="title">Analysis <span>Result</span></div>
      </div>
      <div class="actions">
        <a class="btn" href="/">Upload New</a>
        <button class="btn icon-only" id="themeToggle" title="Toggle Theme">
          <svg id="moon" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
          <svg id="sun" viewBox="0 0 24 24" style="display:none"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>
        </button>
      </div>
    </div>

    <div class="container">
      <div class="result-layout">
        <div class="sidebar">
           <div class="info-card">
             <div style="font-size:18px; margin-bottom:16px; color:var(--text)">Metrics</div>
             <div class="info-row"><div class="info-label">File</div><div class="info-val">{{ filename }}</div></div>
             <div class="info-row"><div class="info-label">ROI</div><div class="info-val">#{{ roi_id }} / {{ roi_count }}</div></div>
             <div class="info-row"><div class="info-label">m/px</div><div class="info-val mono">{{ "%.4e"|format(nm_per_px * 1e-9) }} ({{ nm_per_px_source }})</div></div>
             <div class="info-row"><div class="info-label">Length (px)</div><div class="info-val mono">{{ "%.4e"|format(length_px) }}</div></div>
             <div class="info-row"><div class="info-label">LLL (m)</div><div class="info-val mono">{{ "%.4e"|format(metrics["LLL_m"]) }}</div></div>
             <div class="info-row"><div class="info-label">Area (m²)</div><div class="info-val mono">{{ "%.4e"|format(metrics["AAA_m2"]) }}</div></div>
             <div class="info-row"><div class="info-label">ρA (m⁻¹)</div><div class="info-val mono" style="color:var(--brand)">{{ "%.4e"|format(metrics["rhoA_m-1"]) }}</div></div>
             <div class="info-row"><div class="info-label">ρ (m⁻²)</div><div class="info-val mono" style="color:var(--brand)">{{ "%.4e"|format(metrics["rho_m-2"]) if metrics["rho_m-2"] is not none else "N/A" }}</div></div>
           </div>
        </div>

        <div class="gallery">
          <div class="img-card">
            <div class="img-head"><div class="img-title">Original (Raw)</div></div>
            <div class="img-wrap"><img src="{{ images.raw }}" onclick="openModal(this)" /></div>
          </div>
          <div class="img-card">
            <div class="img-head"><div class="img-title">ROI Crop</div></div>
            <div class="img-wrap"><img src="{{ images.roi }}" onclick="openModal(this)" /></div>
          </div>
          <div class="img-card">
            <div class="img-head"><div class="img-title">Preprocessed</div></div>
            <div class="img-wrap"><img src="{{ images.pre }}" onclick="openModal(this)" /></div>
          </div>
          <div class="img-card">
            <div class="img-head"><div class="img-title">Enhanced (Frangi)</div></div>
            <div class="img-wrap"><img src="{{ images.enhanced }}" onclick="openModal(this)" /></div>
          </div>
          <div class="img-card">
            <div class="img-head"><div class="img-title">Binary Mask</div></div>
            <div class="img-wrap"><img src="{{ images.mask }}" onclick="openModal(this)" /></div>
          </div>
          <div class="img-card">
            <div class="img-head"><div class="img-title">Skeleton Overlay</div></div>
            <div class="img-wrap" style="position:relative">
              <img src="{{ images.overlay }}" class="overlay-img" style="position:absolute; top:0; left:0; transition:opacity 0.2s" onclick="openModal(this)" />
              <img src="{{ images.roi }}" class="base-img" style="display:block" onclick="openModal(this)" />
              <div style="position:absolute; bottom:5px; right:5px; background:rgba(0,0,0,0.6); color:#fff; padding:2px 6px; font-size:10px; border-radius:4px; pointer-events:none">Hover to Hide</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <style>
      .img-card:last-child .img-wrap:hover .overlay-img {
        opacity: 0;
      }
    </style>

    <div id="modal" class="modal" onclick="closeModal(event)">
      <div class="modal-content">
        <span class="modal-close" onclick="closeModal(event)">✕</span>
        <img id="modalImg" src="" />
      </div>
    </div>

    <script src="{{ url_for('static', filename='app.js', v=static_v) }}"></script>
  </body>
</html>
